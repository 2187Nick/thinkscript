# Option Volume
# Twitter @2187Nick

declare upper;
declare once_per_bar;
input symbol = "SPXW";
input strikeSpacing = 5.0;
input Tradesize = 500;
#input strikes = {default "0", "1", "2", "3", "4", "5", "6", "7", "8", "9",
#"10", "11", "12", "13", "14","15", "16", "17", "18", "19", "20"};
input strikes = 10;

input roundup = no; # helpful with stock price below $10

input ManuallySetExpiration = {default "false", "true"};
input Expiration_YYMMDD = 231020;

def CurrentYear = GetYear() - 2000;
def CurrentMonth = GetMonth();
def CurrentDOM = GetDayOfMonth(GetYYYYMMDD());
def DateString_auto = CurrentYear * 10000 + CurrentMonth * 100 + CurrentDOM;

def DateString = if manuallysetexpiration then Expiration_YYMMDD else  DateString_auto;

DefineGlobalColor("CallColor", Color.GREEN);
DefineGlobalColor("PutColor", Color.RED);
AddLabel(yes, AsPrice(DateString) + "C", GlobalColor("CallColor"));
AddLabel(yes, AsPrice(DateString) + "P", GlobalColor("PutColor"));

def agg = AggregationPeriod.DAY;
def openlevel = open(period = agg);
def rounding_factor = if strikeSpacing > 1 and strikeSpacing < 25 then -1 else if strikeSpacing > 24 then -2 else 0;
def floor_or_ceiling =  Round(openlevel, rounding_factor);
def base_strike = floor_or_ceiling;

plot strike_base = base_strike;
plot strike_plus1 = base_strike + strikeSpacing;
plot strike_plus2 = base_strike + strikeSpacing * 2;
plot strike_plus3 = base_strike + strikeSpacing * 3;
plot strike_plus4 = base_strike + strikeSpacing * 4;
plot strike_plus5 = base_strike + strikeSpacing * 5;
plot strike_plus6 = base_strike + strikeSpacing * 6;
plot strike_plus7 = base_strike + strikeSpacing * 7;
plot strike_plus8 = base_strike + strikeSpacing * 8;
plot strike_plus9 = base_strike + strikeSpacing * 9;
plot strike_plus10 = base_strike + strikeSpacing * 10;
plot strike_plus11 = base_strike + strikeSpacing * 11;
plot strike_plus12 = base_strike + strikeSpacing * 12;
plot strike_plus13 = base_strike + strikeSpacing * 13;
plot strike_plus14 = base_strike + strikeSpacing * 14;
plot strike_plus15 = base_strike + strikeSpacing * 15;
plot strike_plus16 = base_strike + strikeSpacing * 16;
plot strike_plus17 = base_strike + strikeSpacing * 17;
plot strike_plus18 = base_strike + strikeSpacing * 18;
plot strike_plus19 = base_strike + strikeSpacing * 19;
plot strike_plus20 = base_strike + strikeSpacing * 20;
plot strike_plus21 = base_strike + strikeSpacing * 21;

plot strike_minus1 = base_strike - strikeSpacing;
plot strike_minus2 = base_strike - strikeSpacing * 2;
plot strike_minus3 = base_strike - strikeSpacing * 3;
plot strike_minus4 = base_strike - strikeSpacing * 4;
plot strike_minus5 = base_strike - strikeSpacing * 5;
plot strike_minus6 = base_strike - strikeSpacing * 6;
plot strike_minus7 = base_strike - strikeSpacing * 7;
plot strike_minus8 = base_strike - strikeSpacing * 8;
plot strike_minus9 = base_strike - strikeSpacing * 9;
plot strike_minus10 = base_strike - strikeSpacing * 10;
plot strike_minus11 = base_strike - strikeSpacing * 11;
plot strike_minus12 = base_strike - strikeSpacing * 12;
plot strike_minus13 = base_strike - strikeSpacing * 13;
plot strike_minus14 = base_strike - strikeSpacing * 14;
plot strike_minus15 = base_strike - strikeSpacing * 15;
plot strike_minus16 = base_strike - strikeSpacing * 16;
plot strike_minus17 = base_strike - strikeSpacing * 17;
plot strike_minus18 = base_strike - strikeSpacing * 18;
plot strike_minus19 = base_strike - strikeSpacing * 19;
plot strike_minus20 = base_strike - strikeSpacing * 20;
plot strike_minus21 = base_strike - strikeSpacing * 21;

### Put Option Volume
def putOptionVolume = if IsNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_base))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_base));
def putOptionVolume1 =  if strikes < 1 then 0 else if IsNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus1))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus1));
def putOptionVolume2 =  if strikes < 2 then 0 else if IsNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus2))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus2));
def putOptionVolume3 =  if strikes < 3 then 0 else if IsNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus3))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus3));
def putOptionVolume4 = if strikes < 4 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus4))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus4));
def putOptionVolume5 = if strikes < 5 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus5))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus5));
def putOptionVolume6 = if strikes < 6 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus6))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus6));
def putOptionVolume7 = if strikes < 7 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus7))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus7));
def putOptionVolume8 = if strikes < 8 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus8))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus8));
def putOptionVolume9 = if strikes < 9 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus9))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus9));
def putOptionVolume10 = if strikes < 10 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus10))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus10));
def putOptionVolume11 = if strikes < 11 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus11))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus11));
def putOptionVolume12 = if strikes < 12 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus12))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus12));
def putOptionVolume13 = if strikes < 13 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus13))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus13));
def putOptionVolume14 = if strikes < 14 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus14))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus14));
def putOptionVolume15 = if strikes < 15 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus15))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus15));
def putOptionVolume16 = if strikes < 16 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus16))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus16));
def putOptionVolume17 = if strikes < 17 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus17))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus17));
def putOptionVolume18 = if strikes < 18 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus18))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus18));
def putOptionVolume19 = if strikes < 19 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus19))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus19));
def putOptionVolume20 = if strikes < 20 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus20))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_minus20));


def putOptionVolume1a =  if strikes < 1 then 0 else if IsNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus1))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus1));
def putOptionVolume2a =  if strikes < 2 then 0 else if IsNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus2))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus2));
def putOptionVolume3a =  if strikes < 3 then 0 else if IsNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus3))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus3));
def putOptionVolume4a = if strikes < 4 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus4))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus4));
def putOptionVolume5a = if strikes < 5 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus5))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus5));
def putOptionVolume6a = if strikes < 6 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus6))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus6));
def putOptionVolume7a = if strikes < 7 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus7))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus7));
def putOptionVolume8a = if strikes < 8 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus8))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus8));
def putOptionVolume9a = if strikes < 9 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus9))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus9));
def putOptionVolume10a = if strikes < 10 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus10))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus10));
def putOptionVolume11a = if strikes < 11 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus11))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus11));
def putOptionVolume12a = if strikes < 12 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus12))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus12));
def putOptionVolume13a = if strikes < 13 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus13))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus13));
def putOptionVolume14a = if strikes < 14 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus14))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus14));
def putOptionVolume15a = if strikes < 15 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus15))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus15));
def putOptionVolume16a = if strikes < 16 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus16))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus16));
def putOptionVolume17a = if strikes < 17 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus17))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus17));
def putOptionVolume18a = if strikes < 18 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus18))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus18));
def putOptionVolume19a = if strikes < 19 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus19))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus19));
def putOptionVolume20a = if strikes < 20 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus20))) then 0 else volume("." + symbol + AsPrice(DateString) + "P" + AsPrice(strike_plus20));

###Call Option Volume
def callOptionVolume = if IsNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_base))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_base));
def callOptionVolume1 =  if strikes < 1 then 0 else if IsNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus1))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus1));
def callOptionVolume2 =  if strikes < 2 then 0 else if IsNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus2))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus2));
def callOptionVolume3 =  if strikes < 3 then 0 else if IsNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus3))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus3));
def callOptionVolume4 = if strikes < 4 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus4))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus4));
def callOptionVolume5 = if strikes < 5 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus5))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus5));
def callOptionVolume6 = if strikes < 6 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus6))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus6));
def callOptionVolume7 = if strikes < 7 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus7))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus7));
def callOptionVolume8 = if strikes < 8 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus8))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus8));
def callOptionVolume9 = if strikes < 9 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus9))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus9));
def callOptionVolume10 = if strikes < 10 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus10))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus10));
def callOptionVolume11 = if strikes < 11 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus11))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus11));
def callOptionVolume12 = if strikes < 12 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus12))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus12));
def callOptionVolume13 = if strikes < 13 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus13))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus13));
def callOptionVolume14 = if strikes < 14 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus14))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus14));
def callOptionVolume15 = if strikes < 15 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus15))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus15));
def callOptionVolume16 = if strikes < 16 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus16))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus16));
def callOptionVolume17 = if strikes < 17 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus17))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus17));
def callOptionVolume18 = if strikes < 18 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus18))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus18));
def callOptionVolume19 = if strikes < 19 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus19))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus19));
def callOptionVolume20 = if strikes < 20 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus20))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_plus20));

def callOptionVolume1a =  if strikes < 1 then 0 else if IsNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus1))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus1));
def callOptionVolume2a =  if strikes < 2 then 0 else if IsNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus2))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus2));
def callOptionVolume3a =  if strikes < 3 then 0 else if IsNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus3))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus3));
def callOptionVolume4a = if strikes < 4 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus4))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus4));
def callOptionVolume5a = if strikes < 5 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus5))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus5));
def callOptionVolume6a = if strikes < 6 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus6))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus6));
def callOptionVolume7a = if strikes < 7 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus7))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus7));
def callOptionVolume8a = if strikes < 8 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus8))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus8));
def callOptionVolume9a = if strikes < 9 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus9))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus9));
def callOptionVolume10a = if strikes < 10 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus10))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus10));
def callOptionVolume11a = if strikes < 11 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus11))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus11));
def callOptionVolume12a = if strikes < 12 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus12))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus12));
def callOptionVolume13a = if strikes < 13 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus13))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus13));
def callOptionVolume14a = if strikes < 14 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus14))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus14));
def callOptionVolume15a = if strikes < 15 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus15))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus15));
def callOptionVolume16a = if strikes < 16 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus16))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus16));
def callOptionVolume17a = if strikes < 17 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus17))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus17));
def callOptionVolume18a = if strikes < 18 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus18))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus18));
def callOptionVolume19a = if strikes < 19 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus19))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus19));
def callOptionVolume20a = if strikes < 20 then 0 else if isNaN(volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus20))) then 0 else volume("." + symbol + AsPrice(DateString) + "C" + AsPrice(strike_minus20));

######################
#Chart Bubbles Puts

AddChartBubble(putOptionVolume > Tradesize, strike_base, putOptionVolume, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume1 > Tradesize, strike_minus1, putOptionVolume1, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume2 > Tradesize, strike_minus2, putOptionVolume2, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume3 > Tradesize, strike_minus3, putOptionVolume3, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume4 > Tradesize, strike_minus4, putOptionVolume4, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume5 > Tradesize, strike_minus5, putOptionVolume5, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume6 > Tradesize, strike_minus6, putOptionVolume6, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume7 > Tradesize, strike_minus7, putOptionVolume7, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume8 > Tradesize, strike_minus8, putOptionVolume8, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume9 > Tradesize, strike_minus9, putOptionVolume9, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume10 > Tradesize, strike_minus10, putOptionVolume10, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume11 > Tradesize, strike_minus11, putOptionVolume11, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume12 > Tradesize, strike_minus12, putOptionVolume12, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume13 > Tradesize, strike_minus13, putOptionVolume13, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume14 > Tradesize, strike_minus14, putOptionVolume14, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume15 > Tradesize, strike_minus15, putOptionVolume15, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume16 > Tradesize, strike_minus16, putOptionVolume16, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume17 > Tradesize, strike_minus17, putOptionVolume17, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume18 > Tradesize, strike_minus18, putOptionVolume18, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume19 > Tradesize, strike_minus19, putOptionVolume19, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume20 > Tradesize, strike_minus20, putOptionVolume20, GlobalColor("PutColor"), no);

AddChartBubble(putOptionVolume1a > Tradesize, strike_plus1, putOptionVolume1a, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume2a > Tradesize, strike_plus2, putOptionVolume2a, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume3a > Tradesize, strike_plus3, putOptionVolume3a, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume4a > Tradesize, strike_plus4, putOptionVolume4a, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume5a > Tradesize, strike_plus5, putOptionVolume5a, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume6a > Tradesize, strike_plus6, putOptionVolume6a, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume7a > Tradesize, strike_plus7, putOptionVolume7a, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume8a > Tradesize, strike_plus8, putOptionVolume8a, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume9a > Tradesize, strike_plus9, putOptionVolume9a, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume10a > Tradesize, strike_plus10, putOptionVolume10a, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume11a > Tradesize, strike_plus11, putOptionVolume11a, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume12a > Tradesize, strike_plus12, putOptionVolume12a, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume13a > Tradesize, strike_plus13, putOptionVolume13a, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume14a > Tradesize, strike_plus14, putOptionVolume14a, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume15a > Tradesize, strike_plus15, putOptionVolume15a, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume16a > Tradesize, strike_plus16, putOptionVolume16a, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume17a > Tradesize, strike_plus17, putOptionVolume17a, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume18a > Tradesize, strike_plus18, putOptionVolume18a, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume19a > Tradesize, strike_plus19, putOptionVolume19a, GlobalColor("PutColor"), no);
AddChartBubble(putOptionVolume20a > Tradesize, strike_plus20, putOptionVolume20a, GlobalColor("PutColor"), no);

#Chart Bubbles for Calls
AddChartBubble(callOptionVolume> Tradesize, strike_base, callOptionVolume , GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume1 > Tradesize, strike_plus1, callOptionVolume1a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume2 > Tradesize, strike_plus2, callOptionVolume2a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume3 > Tradesize, strike_plus3, callOptionVolume3a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume4 > Tradesize, strike_plus4, callOptionVolume4a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume5 > Tradesize, strike_plus5, callOptionVolume5a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume6 > Tradesize, strike_plus6, callOptionVolume6a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume7 > Tradesize, strike_plus7, callOptionVolume7a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume8 > Tradesize, strike_plus8, callOptionVolume8a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume9 > Tradesize, strike_plus9, callOptionVolume9a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume10 > Tradesize, strike_plus10, callOptionVolume10a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume11 > Tradesize, strike_plus11, callOptionVolume11a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume12 > Tradesize, strike_plus12, callOptionVolume12a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume13 > Tradesize, strike_plus13, callOptionVolume13a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume14 > Tradesize, strike_plus14, callOptionVolume14a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume15 > Tradesize, strike_plus15, callOptionVolume15a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume16 > Tradesize, strike_plus16, callOptionVolume16a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume17 > Tradesize, strike_plus17, callOptionVolume17a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume18 > Tradesize, strike_plus18, callOptionVolume18a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume19 > Tradesize, strike_plus19, callOptionVolume19a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume20 > Tradesize, strike_plus20, callOptionVolume20a, GlobalColor("CallColor"), no);

AddChartBubble(callOptionVolume1a > Tradesize, strike_minus1, callOptionVolume1a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume2a > Tradesize, strike_minus2, callOptionVolume2a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume3a > Tradesize, strike_minus3, callOptionVolume3a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume4a > Tradesize, strike_minus4, callOptionVolume4a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume5a > Tradesize, strike_minus5, callOptionVolume5a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume6a > Tradesize, strike_minus6, callOptionVolume6a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume7a > Tradesize, strike_minus7, callOptionVolume7a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume8a > Tradesize, strike_minus8, callOptionVolume8a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume9a > Tradesize, strike_minus9, callOptionVolume9a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume10a > Tradesize, strike_minus10, callOptionVolume10a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume11a > Tradesize, strike_minus11, callOptionVolume11a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume12a > Tradesize, strike_minus12, callOptionVolume12a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume13a > Tradesize, strike_minus13, callOptionVolume13a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume14a > Tradesize, strike_minus14, callOptionVolume14a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume15a > Tradesize, strike_minus15, callOptionVolume15a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume16a > Tradesize, strike_minus16, callOptionVolume16a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume17a > Tradesize, strike_minus17, callOptionVolume17a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume18a > Tradesize, strike_minus18, callOptionVolume18a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume19a > Tradesize, strike_minus19, callOptionVolume19a, GlobalColor("CallColor"), no);
AddChartBubble(callOptionVolume20a > Tradesize, strike_minus20, callOptionVolume20a, GlobalColor("CallColor"), no);

strike_minus1.SetHiding(strikes <= 0);
strike_plus1.SetHiding(strikes <= 0);
strike_minus2.SetHiding(strikes <= 1);
strike_plus2.SetHiding(strikes <= 1);
strike_minus3.SetHiding(strikes <= 2);
strike_plus3.SetHiding(strikes <= 2);
strike_minus4.SetHiding(strikes <= 3);
strike_plus4.SetHiding(strikes <= 3);
strike_minus5.SetHiding(strikes <= 4);
strike_plus5.SetHiding(strikes <= 4);
strike_minus6.SetHiding(strikes <= 5);
strike_plus6.SetHiding(strikes <= 5);
strike_minus7.SetHiding(strikes <= 6);
strike_plus7.SetHiding(strikes <= 6);
strike_minus8.SetHiding(strikes <= 7);
strike_plus8.SetHiding(strikes <= 7);
strike_minus9.SetHiding(strikes <= 8);
strike_plus9.SetHiding(strikes <= 8);
strike_minus10.SetHiding(strikes <= 9);
strike_plus10.SetHiding(strikes <= 9);
strike_minus11.SetHiding(strikes <= 10);
strike_plus11.SetHiding(strikes <= 10);
strike_minus12.SetHiding(strikes <= 11);
strike_plus12.SetHiding(strikes <= 11);
strike_minus13.SetHiding(strikes <= 12);
strike_plus13.SetHiding(strikes <= 12);
strike_minus14.SetHiding(strikes <= 13);
strike_plus14.SetHiding(strikes <= 13);
strike_minus15.SetHiding(strikes <= 14);
strike_plus15.SetHiding(strikes <= 14);
strike_minus16.SetHiding(strikes <= 15);
strike_plus16.SetHiding(strikes <= 15);
strike_minus17.SetHiding(strikes <= 16);
strike_plus17.SetHiding(strikes <= 16);
strike_minus18.SetHiding(strikes <= 17);
strike_plus18.SetHiding(strikes <= 17);
strike_minus19.SetHiding(strikes <= 18);
strike_plus19.SetHiding(strikes <= 18);
strike_minus20.SetHiding(strikes <= 19);
strike_plus20.SetHiding(strikes <= 19);
strike_minus21.SetHiding(strikes <= 20);
strike_plus21.SetHiding(strikes <= 20);

strike_base.SetDefaultColor(Color.blue);
strike_plus1.SetDefaultColor(Color.Dark_Gray);
strike_plus2.SetDefaultColor(Color.Dark_Gray);
strike_plus3.SetDefaultColor(Color.Dark_Gray);
strike_plus4.SetDefaultColor(Color.Dark_Gray);
strike_plus5.SetDefaultColor(Color.Dark_Gray);
strike_plus6.SetDefaultColor(Color.Dark_Gray);
strike_plus7.SetDefaultColor(Color.Dark_Gray);
strike_plus8.SetDefaultColor(Color.Dark_Gray);
strike_plus9.SetDefaultColor(Color.Dark_Gray);
strike_plus10.SetDefaultColor(Color.Dark_Gray);
strike_plus11.SetDefaultColor(Color.Dark_Gray);
strike_plus12.SetDefaultColor(Color.Dark_Gray);
strike_plus13.SetDefaultColor(Color.Dark_Gray);
strike_plus14.SetDefaultColor(Color.Dark_Gray);
strike_plus15.SetDefaultColor(Color.Dark_Gray);
strike_plus16.SetDefaultColor(Color.Dark_Gray);
strike_plus17.SetDefaultColor(Color.Dark_Gray);
strike_plus18.SetDefaultColor(Color.Dark_Gray);
strike_plus19.SetDefaultColor(Color.Dark_Gray);
strike_plus20.SetDefaultColor(Color.Dark_Gray);
strike_plus21.SetDefaultColor(Color.Dark_Gray);

strike_minus1.SetDefaultColor(Color.Dark_Gray);
strike_minus2.SetDefaultColor(Color.Dark_Gray);
strike_minus3.SetDefaultColor(Color.Dark_Gray);
strike_minus4.SetDefaultColor(Color.Dark_Gray);
strike_minus5.SetDefaultColor(Color.Dark_Gray);
strike_minus6.SetDefaultColor(Color.Dark_Gray);
strike_minus7.SetDefaultColor(Color.Dark_Gray);
strike_minus8.SetDefaultColor(Color.Dark_Gray);
strike_minus9.SetDefaultColor(Color.Dark_Gray);
strike_minus10.SetDefaultColor(Color.Dark_Gray);
strike_minus11.SetDefaultColor(Color.Dark_Gray);
strike_minus12.SetDefaultColor(Color.Dark_Gray);
strike_minus13.SetDefaultColor(Color.Dark_Gray);
strike_minus14.SetDefaultColor(Color.Dark_Gray);
strike_minus15.SetDefaultColor(Color.Dark_Gray);
strike_minus16.SetDefaultColor(Color.Dark_Gray);
strike_minus17.SetDefaultColor(Color.Dark_Gray);
strike_minus18.SetDefaultColor(Color.Dark_Gray);
strike_minus19.SetDefaultColor(Color.Dark_Gray);
strike_minus20.SetDefaultColor(Color.Dark_Gray);
strike_minus21.SetDefaultColor(Color.Dark_Gray);
