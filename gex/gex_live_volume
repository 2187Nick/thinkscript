def CurrentYear = GetYear()-2000;
def CurrentMonth = GetMonth();
def CurrentDOM = GetDayOfMonth(GetYYYYMMDD());
def DateString = CurrentYear*10000+CurrentMonth*100+CurrentDOM+getdaystoexpiration()-1;

input threshold = 25; # millions

def gex = if IsNan((volume("."+getunderlyingSymbol()+ AsPrice(DateString) + "C" +getStrike()) -  volume("."+getunderlyingSymbol()+AsPrice(DateString) + "P" + getStrike()))* Gamma() * close(getunderlyingSymbol()) /10000) then 0 else round((volume("."+getunderlyingSymbol()+ AsPrice(DateString) + "C" +getStrike()) -  volume("."+getunderlyingSymbol()+AsPrice(DateString) + "P" + getStrike()))* Gamma() * close(getunderlyingSymbol()) /10000,1);

addlabel(IsPut() and gex <= -.1, gex, if gex <= (-1*threshold) then color.red else color.light_red);
addlabel(IsPut() and gex >= 0, "", color.black);

addlabel(!IsPut() and gex >= .1, gex,  if gex >= threshold then color.green else color.light_green);
addlabel(!IsPut() and gex < 0, "", color.black);

assignBackgroundColor(color.black);
